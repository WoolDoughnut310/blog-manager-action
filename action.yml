name: "Blog Manager Action"
description: "A GitHub Action that uploads articles to your blogging platform"
inputs:
  medium_integration_token:
    description: "Medium's Integration Token. Token can be retrieved at medium.com/me/settings/security, under 'Integration tokens'"
    required: true
  hashnode_integration_token:
    description: "Hashnode's Integration Token. Token can be retrieved at hashnode.com/settings/developer"
    required: true
  github_token:
    description: "A GitHub PAT"
    required: true
  imgbb_api_key:
    description: "API Key for Imgbb CDN"
    required: true
outputs:
  hashnode_id:
    description: "ID of the Hashnode Post"
    value: ${{ steps.run-script.outputs.hashnode_id }}
  hashnode_url:
    description: "URL of the Hashnode Post"
    value: ${{ steps.run-script.outputs.hashnode_url }}
  medium_id:
    description: "ID of the Medium Post"
    value: ${{ steps.run-script.outputs.medium_id }}
  medium_url:
    description: "URL of the Medium Post"
    value: ${{ steps.run-script.outputs.medium_url }}
runs:
  using: "composite"
  steps:
    - name: Install Python
      uses: actions/setup-python@v4
      with:
        python-version: "3.9"
    - name: Load cached Poetry installation
      id: cached-poetry
      uses: actions/cache@v3
      with:
        path: ~/.local # the path depends on the OS
        key: poetry-0 # increment to reset cache
    - name: Install Poetry
      if: steps.cached-poetry.outputs.cache-hit != 'true'
      uses: snok/install-poetry@v1.3.3
      with:
        virtualenvs-create: true
        virtualenvs-in-project: true
        installer-parallel: true
    - name: Install dependencies
      if: steps.cached-poetry-dependencies.outputs.cache-hit != 'true'
      run: poetry install --no-interaction --no-root
      shell: bash
    - name: Install project
      run: poetry install --no-interaction
      shell: bash

    - name: Pass Inputs to Shell
      run: |
        echo "MEDIUM_INTEGRATION_TOKEN=${{ inputs.medium_integration_token }}" >> $GITHUB_ENV
        echo "HASHNODE_INTEGRATION_TOKEN=${{ inputs.hashnode_integration_token }}" >> $GITHUB_ENV
        echo "IMGBB_API_KEY=${{ inputs.hashnode_integration_token }}" >> $GITHUB_ENV
      shell: bash
    - name: Check Dirs
      run: ls
      shell: bash
    - name: run-script
      run: |
        source .venv/bin/activate
        python blog_manager_action/main.py
      shell: bash
    - name: Update article files
      uses: test-room-7/action-update-file@v1
      with:
        file-path: ./**/article.md
        commit-msg: Update article files
        github-token: ${{ inputs.github_token }}
